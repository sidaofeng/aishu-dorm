<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.waken.dorm.dao.dorm.DormScoreMapper">
    <insert id="batchAddDormScore" parameterType="java.util.List">
        insert into rm_dorm_score
        (pk_dorm_score_id,
        dorm_num,
        culture_score,
        discipline_score,
        bed_score,
        desk_score,
        balcony_score,
        toilet_score,
        ground_score,
        door_window_score,
        metope_score,
        total_score,
        status,
        create_user_id,
        create_time,
        last_modify_user_id,
        last_modify_time,
        memo)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.pkDormScoreId},
            #{item.dormNum},
            #{item.cultureScore},
            #{item.disciplineScore},
            #{item.bedScore},
            #{item.deskScore},
            #{item.balconyScore},
            #{item.toiletScore},
            #{item.groundScore},
            #{item.doorWindowScore},
            #{item.metopeScore},
            #{item.totalScore},
            #{item.status},
            #{item.createUserId},
            #{item.createTime},
            #{item.lastModifyUserId},
            #{item.lastModifyTime},
            #{item.memo})
        </foreach>
    </insert>
    <select id="appListDormScoreView" parameterType="com.waken.dorm.common.form.dorm.ListDormScoreForm"
            resultType="com.waken.dorm.common.view.dorm.AppDormScoreView">
        SELECT
        ds.pk_dorm_score_id AS pkDormScoreId,
        ds.dorm_num AS dormNum,
        ds.culture_score AS cultureScore,
        ds.discipline_score AS disciplineScore,
        ds.bed_score AS bedScore,
        ds.desk_score AS deskScore,
        ds.balcony_score AS balconyScore,
        ds.toilet_score AS toiletScore,
        ds.ground_score AS groundScore,
        ds.door_window_score AS doorWindowScore,
        ds.metope_score AS metopeScore,
        ds.total_score AS totalScore,
        ds.memo AS memo
        FROM rm_dorm_score ds
        LEFT JOIN rm_dorm d ON d.dorm_num = ds.dorm_num
        LEFT JOIN rm_dorm_student_rel dsr ON dsr.dorm_id = d.pk_dorm_id
        WHERE
        ds.`status` = 1
        <if test="studentId != null and studentId != ''">
            AND dsr.student_id = #{studentId,jdbcType=VARCHAR}
        </if>
    </select>
    <select id="listDormScores" parameterType="com.waken.dorm.common.form.dorm.ListDormScoreForm"
            resultType="com.waken.dorm.common.view.dorm.DormScoreView">
        SELECT
        ds.pk_dorm_score_id AS pkDormScoreId,
        ds.dorm_num AS dormNum,
        ds.culture_score AS cultureScore,
        ds.discipline_score AS disciplineScore,
        ds.bed_score AS bedScore,
        ds.desk_score AS deskScore,
        ds.balcony_score AS balconyScore,
        ds.toilet_score AS toiletScore,
        ds.ground_score AS groundScore,
        ds.door_window_score AS doorWindowScore,
        ds.metope_score AS metopeScore,
        ds.total_score AS totalScore,
        ds.`status`,
        ds.create_time AS createTime,
        u.user_name AS createUserName,
        ds.last_modify_time AS lastModifyTime,
        uu.user_name AS lastModifyUserName,
        ds.memo
        FROM rm_dorm_score ds
        LEFT JOIN rm_dorm d ON d.dorm_num = ds.dorm_num
        LEFT JOIN rm_dorm_student_rel dsr ON dsr.dorm_id = d.pk_dorm_id
        LEFT JOIN rm_user u ON u.user_id = ds.create_user_id
        LEFT JOIN rm_user uu ON uu.user_id = ds.last_modify_user_id
        LEFT JOIN rm_dorm_building db ON db.pk_dorm_building_id = d.dorm_building_id
        WHERE 1=1
        <if test="pkDormScoreId != null and pkDormScoreId != ''">
            and ds.pk_dorm_score_id=#{pkDormScoreId}
        </if>
        <if test="dormNum != null and dormNum != ''">
            and d.dorm_num like '%${dormNum}%'
        </if>
        <if test="status != null">
            and ds.status=#{status}
        </if>
        <if test="createUserName != null and createUserName != ''">
            and u.user_name like '%${createUserName}%'
        </if>
        <if test="lastModifyUserName != null and lastModifyUserName != ''">
            and uu.user_name like '%${lastModifyUserName}%'
        </if>
        <if test="startTime != null">
            AND ds.create_time &gt;= #{startTime,jdbcType=TIMESTAMP}
        </if>
        <if test="endTime != null">
            AND ds.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
        </if>
        ORDER BY
        ds.last_modify_time DESC
    </select>
    <update id="batchUpdateStatus" parameterType="java.util.Map">
        <foreach collection="list" separator=";" item="ur">
            update rm_dorm_score set
            status = #{ur.status},
            last_modify_time = #{ur.lastModifyTime},
            last_modify_user_id = #{ur.lastModifyUserId}
            where pk_dorm_score_id = #{ur.pkId}
        </foreach>
    </update>
</mapper>