<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.waken.dorm.dao.log.SysLogMapper">
    <resultMap id="BaseResultMap" type="com.waken.dorm.common.entity.log.SysLog">
        <id column="pk_log_id" property="pkLogId" jdbcType="VARCHAR"/>
        <result column="user_id" property="userId" jdbcType="VARCHAR"/>
        <result column="operation_content" property="operationContent" jdbcType="VARCHAR"/>
        <result column="duration" property="duration" jdbcType="INTEGER"/>
        <result column="method" property="method" jdbcType="VARCHAR"/>
        <result column="params" property="params" jdbcType="VARCHAR"/>
        <result column="ip" property="ip" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="location" property="location" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
        pk_log_id, user_id, operation_content, duration, method, params, ip, create_time,
        location
    </sql>
    <select id="listSysLogViews" resultType="com.waken.dorm.common.view.log.SysLogView"
            parameterType="com.waken.dorm.common.form.log.SysLogForm">
        SELECT
        l.pk_log_id AS pkLogId,
        u.user_name AS userName,
        l.operation_content AS operationContent,
        l.duration,
        l.method,
        l.params,
        l.ip,
        l.create_time AS createTime,
        l.location
        FROM rm_log l
        LEFT JOIN rm_user u ON u.user_id = l.user_id
        WHERE 1=1
        <where>
            <if test="pkLogId != null and pkLogId != ''">
                AND l.pk_log_id=#{pkLogId,jdbcType=VARCHAR}
            </if>
            <if test="keyWord != null">
                <bind name="keyWord" value="'%' + keyWord + '%'"/>
                AND (u.user_name LIKE #{keyWord,jdbcType=VARCHAR}
                OR l.operation_content LIKE #{keyWord,jdbcType=VARCHAR}
                OR l.method LIKE #{keyWord,jdbcType=VARCHAR}
                OR l.params LIKE #{keyWord,jdbcType=VARCHAR}
                OR l.ip LIKE #{keyWord,jdbcType=VARCHAR}
                OR l.location LIKE #{keyWord,jdbcType=VARCHAR}
                )
            </if>
            <if test="startTime != null">
                AND l.create_time &gt;= #{startTime,jdbcType=TIMESTAMP}
            </if>
            <if test="endTime != null">
                AND l.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
            </if>
        </where>
        ORDER BY l.create_time DESC
    </select>
</mapper>